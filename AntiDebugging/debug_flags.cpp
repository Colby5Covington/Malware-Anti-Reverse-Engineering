typedef NTSTATUS(NTAPI *typeNtQueryInformationProcess)(
    IN HANDLE           ProcessHandle,
    IN DWORD            ProcessInformationClass,
    OUT PVOID           ProcessInformation,
    IN ULONG            ProcessInformationLength,
    OUT PULONG          ReturnLength
    );

HMODULE load_NtDLL = LoadLibraryA("ntdll.dll");

if (LoadLibraryA("ntdll.dll"))
{
    auto adNtQueryInformationProcess = (typeNtQueryInformationProcess)GetProcAddress(load_NtDLL, "NtQueryInformationProcess");

    if (adNtQueryInformationProcess)
    {
        DWORD dwProcessDebugFlags, dwReturned;
        const DWORD ProcessDebugFlags = 0x1f;
        NTSTATUS status = adNtQueryInformationProcess(GetCurrentProcess(), ProcessDebugFlags, &dwProcessDebugFlags, sizeof(DWORD), &dwReturned);

        if (NT_SUCCESS(status) && (0 == dwProcessDebugFlags))
        {
                    // _tprintf(TEXT("Detected!");
        }
    }
}
